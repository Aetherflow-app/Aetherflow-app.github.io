<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AetherFlow - Pricing</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Paddle Billing JS 集成 -->
    <script src="https://cdn.paddle.com/paddle/v2/paddle.js" async defer></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>AetherFlow</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="pricing.html" class="active">Pricing</a></li>
                    <li><a href="terms-of-service.html">Terms</a></li>
                    <li><a href="privacy-policy.html">Privacy</a></li>
                    <li><a href="refund-policy.html">Refunds</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="pricing-hero">
        <div class="container">
            <div class="pricing-hero-content">
                <h1>Simple, Transparent Pricing</h1>
                <p>Choose the plan that best fits your needs</p>
            </div>
        </div>
    </section>

    <section class="pricing-details">
        <div class="container">
            <div class="pricing-tabs">
                <button class="pricing-tab active" onclick="showMonthly()">Monthly</button>
                <button class="pricing-tab" onclick="showAnnual()">Annual (Save 33%)</button>
            </div>

            <div class="pricing-cards-container">
                <div class="pricing-cards">
                    <div class="pricing-card free">
                        <div class="card-header">
                            <h3>Free</h3>
                            <div class="price">$0</div>
                            <p>Forever</p>
                        </div>
                        <div class="card-features">
                            <ul>
                                <li>Store up to 5 prompts</li>
                                <li>3 optimization attempts daily</li>
                                <li>Basic features access</li>
                                <li>Single device usage</li>
                                <li>Community support</li>
                            </ul>
                        </div>
                        <div class="card-action">
                            <a href="https://chrome.google.com/webstore/detail/aetherflow/ldpadjcdbfndeghcklogoppmbnmphbki" class="btn btn-outline">Get Started</a>
                        </div>
                    </div>
                    <div class="pricing-card premium monthly-plan">
                        <div class="most-popular">Most Popular</div>
                        <div class="card-header">
                            <h3>Pro</h3>
                            <div class="price">$4.99</div>
                            <p>per month</p>
                        </div>
                        <div class="card-features">
                            <ul>
                                <li>Store up to 100 prompts</li>
                                <li>50 optimization attempts daily</li>
                                <li>All advanced features</li>
                                <li>Multi-device sync</li>
                                <li>Multi-format data export</li>
                                <li>Priority support</li>
                            </ul>
                        </div>
                        <div class="card-action">
                            <a href="#" class="btn btn-primary" onclick="return openPaddleCheckout('monthly')">Upgrade Now</a>
                        </div>
                    </div>
                    <div class="pricing-card premium annual-plan" style="display: none;">
                        <div class="best-value">Best Value</div>
                        <div class="card-header">
                            <h3>Pro Annual</h3>
                            <div class="price">$39.99</div>
                            <p>per year (Save 33%)</p>
                        </div>
                        <div class="card-features">
                            <ul>
                                <li>Store up to 100 prompts</li>
                                <li>50 optimization attempts daily</li>
                                <li>All advanced features</li>
                                <li>Multi-device sync</li>
                                <li>Multi-format data export</li>
                                <li>Priority support</li>
                                <li>Early access to new features</li>
                            </ul>
                        </div>
                        <div class="card-action">
                            <a href="#" class="btn btn-primary" onclick="return openPaddleCheckout('annual')">Upgrade Now</a>
                        </div>
                    </div>
                </div>
                <p class="subscription-note">All subscriptions automatically renew unless cancelled at least 24 hours before the end of the current period. You can manage your subscription in your account settings.</p>
            </div>
        </div>
    </section>

    <section class="features-comparison">
        <div class="container">
            <h2>Feature Comparison</h2>
            <div class="comparison-table-wrapper">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th>Free</th>
                            <th>Pro</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Prompt Storage</td>
                            <td>5 prompts</td>
                            <td>100 prompts</td>
                        </tr>
                        <tr>
                            <td>Daily Optimization Attempts</td>
                            <td>3</td>
                            <td>50</td>
                        </tr>
                        <tr>
                            <td>Quick Prompt Input</td>
                            <td><span class="check">✓</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Basic Prompt Library</td>
                            <td><span class="check">✓</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Multi-device Sync</td>
                            <td><span class="check">✓</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Prompt Categories</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Advanced Search</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Custom Tags</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Data Export</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Priority Support</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Early Access to New Features</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <section class="faq">
        <div class="container">
            <h2>Frequently Asked Questions</h2>
            <div class="faq-items">
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>How does the billing work?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>For monthly plans, you will be billed every month on the same date you initially subscribed. For annual plans, you will be billed once per year. All plans automatically renew unless cancelled.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>Can I upgrade from monthly to annual?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>Yes, you can upgrade from a monthly to an annual subscription at any time. When you upgrade, you'll be charged for the annual plan, and your monthly subscription will be cancelled.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>How do I cancel my subscription?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>You can cancel your subscription at any time through the AetherFlow extension settings or by accessing the customer portal. After cancellation, you'll still have access to Pro features until the end of your current billing period.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>What happens to my data if I downgrade?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>If you downgrade from Pro to Free, all your prompts will be preserved, but you'll only be able to actively use 5 prompts. The rest will be marked as read-only until you upgrade again.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>Do you offer refunds?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>Yes, we offer a 14-day refund window for new subscriptions. If you're not satisfied with our service during this period, you may request a full refund. Please refer to our <a href="refund-policy.html">Refund Policy</a> for more details.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>Which payment methods do you accept?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>We accept all major credit cards (Visa, MasterCard, American Express), as well as PayPal. All payments are securely processed through Paddle, our payment processor.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="cta">
        <div class="container">
            <h2>Ready to Enhance Your AI Experience?</h2>
            <p>Join thousands of users who are getting better results with AetherFlow Pro</p>
            <a href="#" class="btn btn-large" onclick="scrollToPlans()">Choose Your Plan</a>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h2>AetherFlow</h2>
                    <p>AI Prompt Management Chrome Extension</p>
                </div>
                <div class="footer-links">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="terms-of-service.html">Terms of Service</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="refund-policy.html">Refund Policy</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="pricing.html">Pricing</a></li>
                        <li><a href="https://chrome.google.com/webstore/detail/aetherflow/ldpadjcdbfndeghcklogoppmbnmphbki">Chrome Store</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h4>Contact</h4>
                    <p>Email: support@aetherflow.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 AetherFlow. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化FAQ切换
            const faqQuestions = document.querySelectorAll('.faq-question');
            
            faqQuestions.forEach(item => {
                item.addEventListener('click', function() {
                    const faqItem = item.parentNode;
                    const answer = faqItem.querySelector('.faq-answer');
                    const toggle = item.querySelector('.faq-toggle');
                    
                    // 切换class
                    faqItem.classList.toggle('open');
                    
                    // 更新切换图标
                    if (faqItem.classList.contains('open')) {
                        toggle.textContent = '-';
                        answer.style.maxHeight = answer.scrollHeight + 'px';
                    } else {
                        toggle.textContent = '+';
                        answer.style.maxHeight = '0';
                    }
                });
            });
            
            // 确认 DOM 完全加载后才初始化 Paddle Billing
            setTimeout(() => {
                console.log('DOM is fully loaded, initializing Paddle Billing...');
                // 确保Paddle.js加载完成，然后初始化
                ensurePaddleScriptLoaded()
                    .then(() => {
                        console.log('Paddle.js is ready, initializing...');
                        initializePaddleBilling();
                    })
                    .catch(error => {
                        console.error('Failed to initialize Paddle:', error);
                        // 显示用户友好的错误信息
                        const errorContainer = document.createElement('div');
                        errorContainer.className = 'paddle-error-notice';
                        errorContainer.style.color = 'red';
                        errorContainer.style.padding = '10px';
                        errorContainer.style.margin = '10px 0';
                        errorContainer.style.border = '1px solid red';
                        errorContainer.style.borderRadius = '4px';
                        errorContainer.style.backgroundColor = '#fff8f8';
                        errorContainer.textContent = 'The payment system is currently unavailable. Please try again later or contact support.';
                        
                        // 插入到页面中
                        const pricingCards = document.querySelector('.pricing-cards-container');
                        if (pricingCards) {
                            pricingCards.insertBefore(errorContainer, pricingCards.firstChild);
                        }
                    });
            }, 500);
        });
        
        // 切换月度和年度价格
        function showMonthly() {
            document.querySelector('.monthly-plan').style.display = 'block';
            document.querySelector('.annual-plan').style.display = 'none';
            document.querySelectorAll('.pricing-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.pricing-tab')[0].classList.add('active');
        }
        
        function showAnnual() {
            document.querySelector('.monthly-plan').style.display = 'none';
            document.querySelector('.annual-plan').style.display = 'block';
            document.querySelectorAll('.pricing-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.pricing-tab')[1].classList.add('active');
        }
        
        // 滚动到价格计划部分
        function scrollToPlans() {
            document.querySelector('.pricing-details').scrollIntoView({ behavior: 'smooth' });
        }
        
        // 确保Paddle.js正确加载
        function ensurePaddleScriptLoaded() {
            return new Promise((resolve, reject) => {
                // 检查是否已存在
                if (typeof Paddle !== 'undefined') {
                    console.log('Paddle.js already loaded');
                    resolve();
                    return;
                }
                
                console.log('Dynamically loading Paddle.js...');
                
                // 创建script元素
                const script = document.createElement('script');
                script.src = 'https://cdn.paddle.com/paddle/v2/paddle.js';
                script.type = 'text/javascript';
                
                // 加载成功处理
                script.onload = () => {
                    console.log('Paddle.js loaded successfully');
                    resolve();
                };
                
                // 加载失败处理
                script.onerror = (error) => {
                    console.error('Failed to load Paddle.js:', error);
                    reject(new Error('Failed to load Paddle.js'));
                };
                
                // 添加到文档
                document.head.appendChild(script);
            });
        }
        
        // Paddle Billing 产品/价格ID (注意：Billing API使用priceId而非productId)
        const priceConfigs = {
            production: {
                monthly: 'pri_01jrfcwajex91zya4346h9ek32',
                annual: 'pri_01jrfcz25f4zdktr7rtt1pnzpw'
            },
            sandbox: {
                monthly: 'pri_01jrw0em3kydrg4rw523w6s574',
                annual: 'pri_01jrw0f7y1kfw9jc967eswbnrs'
            }
        };
        
        // 创建环境管理工具
        const PaddleEnv = {
            // 检查是否应该使用沙盒
            shouldUseSandbox: function() {
                // 1. 检查URL参数
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.has('paddle_env')) {
                    const envParam = urlParams.get('paddle_env');
                    // 保存到本地存储以便后续页面使用
                    localStorage.setItem('paddle_environment', envParam);
                    return envParam === 'sandbox';
                }
                
                // 2. 检查本地存储
                const savedEnv = localStorage.getItem('paddle_environment');
                if (savedEnv) {
                    return savedEnv === 'sandbox';
                }
                
                // 3. 检查是否是开发环境
                const isLocalhost = window.location.hostname === 'localhost' || 
                                   window.location.hostname === '127.0.0.1';
                return isLocalhost;
            },
            
            // 获取当前环境名称
            getEnvironmentName: function() {
                return this.shouldUseSandbox() ? 'sandbox' : 'production';
            },
            
            // 获取客户端令牌
            getClientToken: function() {
                return this.shouldUseSandbox() ? 
                    'test_c624a7a4c9993fc8965d9c37db6' :  // 沙盒环境 token
                    'live_74080bad93a7d3b962f98a52c93';   // 生产环境 token
            },
            
            // 获取环境标识UI
            addEnvironmentIndicator: function() {
                // 如果是沙盒环境，添加一个环境指示器
                if (this.shouldUseSandbox()) {
                    const indicator = document.createElement('div');
                    indicator.style.cssText = `
                        position: fixed;
                        bottom: 10px;
                        left: 10px;
                        background-color: #ff9800;
                        color: white;
                        padding: 5px 10px;
                        border-radius: 4px;
                        font-size: 12px;
                        z-index: 9999;
                        cursor: pointer;
                    `;
                    indicator.textContent = '🧪 SANDBOX MODE';
                    indicator.title = 'Click to switch to production mode';
                    indicator.onclick = function() {
                        localStorage.setItem('paddle_environment', 'production');
                        window.location.reload();
                    };
                    document.body.appendChild(indicator);
                }
            },
            
            // 切换环境
            toggleEnvironment: function() {
                const currentEnv = this.getEnvironmentName();
                const newEnv = currentEnv === 'sandbox' ? 'production' : 'sandbox';
                localStorage.setItem('paddle_environment', newEnv);
                console.log(`Switching Paddle environment from ${currentEnv} to ${newEnv}. Reloading...`);
                window.location.reload();
            }
        };
        
        // 初始化Paddle Billing
        function initializePaddleBilling() {
            try {
                console.log('Initializing Paddle Billing...');
                
                // 确保 Paddle 对象存在
                if (typeof Paddle === 'undefined') {
                    console.error('Paddle object is not available. Script might not be loaded correctly.');
                    return;
                }
                
                // 输出 Paddle 版本信息（如果可用）
                if (Paddle.version) {
                    console.log('Paddle version:', Paddle.version);
                }
                
                // 使用环境管理工具检测环境
                const useSandbox = PaddleEnv.shouldUseSandbox();
                const environmentName = PaddleEnv.getEnvironmentName();
                const clientId = PaddleEnv.getClientToken();
                
                console.log('Current hostname:', window.location.hostname);
                console.log('Using Paddle environment:', environmentName);
                console.log('Using client ID:', clientId);
                
                // 设置环境（仅在沙盒环境需要）
                if (useSandbox) {
                    console.log('Setting sandbox environment');
                    Paddle.Environment.set('sandbox');
                }
                
                // 初始化 Paddle Billing
                Paddle.Initialize({
                    token: clientId,
                    checkout: {
                        settings: {
                            locale: 'en-US'
                        }
                    },
                    eventCallback: function(eventData) {
                        // 记录所有事件
                        console.log('Paddle事件:', eventData.name, eventData.data);
                        
                        // 特别关注错误事件
                        if (eventData.name === 'checkout.error') {
                            console.error('Paddle结账错误:', eventData.data);
                        }
                    }
                });
                
                console.log('Paddle Billing initialized successfully');
                
                // 添加环境指示器
                PaddleEnv.addEnvironmentIndicator();
                
                // 添加环境切换按钮到页面
                addEnvironmentToggleButton();
                
            } catch (error) {
                console.error('Error initializing Paddle Billing:', error);
                
                // 更详细地记录错误信息
                if (error instanceof Error) {
                    console.error('Error name:', error.name);
                    console.error('Error message:', error.message);
                    console.error('Error stack:', error.stack);
                }
                
                // 加载状态检查
                if (document.readyState !== 'complete') {
                    console.warn('Document is not fully loaded yet. Current state:', document.readyState);
                }
            }
        }
        
        // 添加环境切换按钮
        function addEnvironmentToggleButton() {
            // 只在价格卡片部分添加
            const pricingSection = document.querySelector('.pricing-details');
            if (!pricingSection) return;
            
            const toggleContainer = document.createElement('div');
            toggleContainer.style.cssText = `
                display: flex;
                justify-content: center;
                margin-top: 20px;
                opacity: 0.6;
            `;
            
            const toggleButton = document.createElement('button');
            toggleButton.style.cssText = `
                background-color: #334155;
                color: white;
                border: none;
                padding: 5px 10px;
                border-radius: 4px;
                font-size: 12px;
                cursor: pointer;
            `;
            toggleButton.textContent = `🔄 Switch to ${PaddleEnv.getEnvironmentName() === 'sandbox' ? 'Production' : 'Sandbox'} Mode`;
            toggleButton.onclick = function() {
                PaddleEnv.toggleEnvironment();
            };
            
            toggleContainer.appendChild(toggleButton);
            pricingSection.appendChild(toggleContainer);
        }
        
        // 打开Paddle Billing结账窗口
        function openPaddleCheckout(plan) {
            try {
                console.log('Paddle Billing checkout triggered for plan:', plan);
                
                // 检查Paddle对象是否存在
                if (typeof Paddle === 'undefined') {
                    console.error('Paddle Billing API not loaded correctly');
                    alert('Payment system unavailable. Please try again later.');
                    return false;
                }
                
                // 确保 Paddle 已初始化
                if (!Paddle.Checkout) {
                    console.error('Paddle Billing API not initialized correctly');
                    alert('Payment system initialization failed. Please try again later.');
                    return false;
                }
                
                // 使用环境管理工具确定环境
                const environmentName = PaddleEnv.getEnvironmentName();
                
                // 获取正确的价格ID
                const config = priceConfigs[environmentName];
                const priceId = plan === 'monthly' ? config.monthly : config.annual;
                
                console.log('Using environment:', environmentName);
                console.log('Selected price ID:', priceId);
                
                // 创建完整的结账配置对象，按照官方文档结构排列
                const checkoutConfig = {
                    // 订阅商品
                    items: [
                        {
                            priceId: priceId,
                            quantity: 1
                        }
                    ],
                    // 结账设置
                    settings: {
                        displayMode: 'overlay',
                        theme: 'light',
                        locale: 'en-US',
                        successUrl: window.location.origin + '/success.html?checkout={{checkoutId}}',
                        closeUrl: window.location.origin + '/cancel.html'
                    },
                    // 客户信息
                    customer: {
                        email: 'customer@example.com' // 提供默认邮箱，用户可在结账时修改
                    },
                    // 自定义数据
                    customData: {
                        plan: plan,
                        source: window.location.search ? new URLSearchParams(window.location.search).get('source') || 'website' : 'website'
                    }
                };

                // 详细记录结账配置
                console.log('Checkout configuration:', JSON.stringify(checkoutConfig, null, 2));

                // 打开结账，添加成功和错误回调
                Paddle.Checkout.open(checkoutConfig)
                    .then((data) => {
                        console.log('Checkout completed successfully:', data);
                    })
                    .catch((error) => {
                        console.error('Checkout error:', error);
                        if (error && error.code) {
                            console.error('Error code:', error.code);
                            console.error('Error message:', error.message);
                        }
                    });
                    
                console.log('Checkout window opened successfully');
                
                return false; // 阻止链接默认行为
                
            } catch (error) {
                console.error('Error opening Paddle Billing checkout:', error);
                alert('An error occurred with the payment system. Please try again later.');
                return false;
            }
        }
    </script>
</body>
</html> 