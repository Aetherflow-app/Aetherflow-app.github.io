<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AetherFlow - Pricing</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- 引入Paddle.js -->
    <script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
    <!-- Firebase引用 -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>AetherFlow</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="pricing.html" class="active">Pricing</a></li>
                    <li><a href="terms-of-service.html">Terms</a></li>
                    <li><a href="privacy-policy.html">Privacy</a></li>
                    <li><a href="refund-policy.html">Refunds</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li class="auth-item"><a href="#" id="authButton" class="auth-button">Sign in</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- 认证模态框 -->
    <div id="authModal" class="auth-modal">
        <div class="auth-modal-content">
            <span class="auth-close">&times;</span>
            <div class="auth-tabs">
                <button class="auth-tab active" id="loginTab">Sign in</button>
                <button class="auth-tab" id="registerTab">Sign up</button>
            </div>
            <div id="loginForm" class="auth-form active">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="Your email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Your password">
                </div>
                <div class="form-error" id="loginError"></div>
                <div class="form-actions">
                    <button id="loginButton" class="btn btn-primary">Sign in</button>
                    <div class="auth-divider">
                        <span>or</span>
                    </div>
                    <button id="googleLoginButton" class="btn btn-outline btn-google">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo">
                        Sign in with Google
                    </button>
                    <div class="form-help">
                        <a href="#" id="forgotPasswordLink">Forgot password?</a>
                    </div>
                </div>
            </div>
            <div id="registerForm" class="auth-form">
                <div class="form-group">
                    <label for="registerName">Name</label>
                    <input type="text" id="registerName" placeholder="Your name">
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" placeholder="Your email">
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" placeholder="Create password">
                </div>
                <div class="form-error" id="registerError"></div>
                <div class="form-actions">
                    <button id="registerButton" class="btn btn-primary">Sign up</button>
                    <div class="auth-divider">
                        <span>or</span>
                    </div>
                    <button id="googleRegisterButton" class="btn btn-outline btn-google">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo">
                        Sign up with Google
                    </button>
                </div>
            </div>
            <div id="forgotPasswordForm" class="auth-form">
                <div class="form-group">
                    <label for="resetEmail">Email</label>
                    <input type="email" id="resetEmail" placeholder="Your email">
                </div>
                <div class="form-error" id="resetError"></div>
                <div class="form-success" id="resetSuccess"></div>
                <div class="form-actions">
                    <button id="resetPasswordButton" class="btn btn-primary">Reset Password</button>
                    <div class="form-help">
                        <a href="#" id="backToLoginLink">Back to login</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 用户菜单 -->
    <div id="userDropdown" class="user-dropdown">
        <div class="user-info">
            <div id="userDisplayName">User Name</div>
            <div id="userEmail">user@example.com</div>
        </div>
        <div class="dropdown-divider"></div>
        <a href="#" id="logoutButton" class="dropdown-item">Sign out</a>
    </div>

    <section class="pricing-hero">
        <div class="container">
            <div class="pricing-hero-content">
                <h1>Simple, Transparent Pricing</h1>
                <p>Choose the plan that best fits your needs</p>
            </div>
        </div>
    </section>

    <section class="pricing-details">
        <div class="container">
            <div class="pricing-tabs">
                <button class="pricing-tab active" onclick="showMonthly()">Monthly</button>
                <button class="pricing-tab" onclick="showAnnual()">Annual (Save 33%)</button>
            </div>

            <div class="pricing-cards-container">
                <div class="pricing-cards">
                    <div class="pricing-card free">
                        <div class="card-header">
                            <h3>Free</h3>
                            <div class="price">$0</div>
                            <p>Forever</p>
                        </div>
                        <div class="card-features">
                            <ul>
                                <li>Store up to 5 prompts</li>
                                <li>3 optimization attempts daily</li>
                                <li>Basic features access</li>
                                <li>Single device usage</li>
                                <li>Community support</li>
                            </ul>
                        </div>
                        <div class="card-action">
                            <a href="https://chrome.google.com/webstore/detail/aetherflow/ldpadjcdbfndeghcklogoppmbnmphbki" class="btn btn-outline">Get Started</a>
                        </div>
                    </div>
                    <div class="pricing-card premium monthly-plan">
                        <div class="most-popular">Most Popular</div>
                        <div class="card-header">
                            <h3>Pro</h3>
                            <div class="price">$4.99</div>
                            <p>per month</p>
                        </div>
                        <div class="card-features">
                            <ul>
                                <li>Store up to 100 prompts</li>
                                <li>50 optimization attempts daily</li>
                                <li>All advanced features</li>
                                <li>Multi-device sync</li>
                                <li>Multi-format data export</li>
                                <li>Priority support</li>
                            </ul>
                        </div>
                        <div class="card-action">
                            <a href="#" class="btn btn-primary monthly-checkout" data-plan="monthly">Upgrade Now</a>
                        </div>
                    </div>
                    <div class="pricing-card premium annual-plan" style="display: none;">
                        <div class="best-value">Best Value</div>
                        <div class="card-header">
                            <h3>Pro Annual</h3>
                            <div class="price">$39.99</div>
                            <p>per year (Save 33%)</p>
                        </div>
                        <div class="card-features">
                            <ul>
                                <li>Store up to 100 prompts</li>
                                <li>50 optimization attempts daily</li>
                                <li>All advanced features</li>
                                <li>Multi-device sync</li>
                                <li>Multi-format data export</li>
                                <li>Priority support</li>
                                <li>Early access to new features</li>
                            </ul>
                        </div>
                        <div class="card-action">
                            <a href="#" class="btn btn-primary annual-checkout" data-plan="annual">Upgrade Now</a>
                        </div>
                    </div>
                </div>
                <p class="subscription-note">All subscriptions automatically renew unless cancelled at least 24 hours before the end of the current period. You can manage your subscription in your account settings.</p>
            </div>
        </div>
    </section>

    <section class="features-comparison">
        <div class="container">
            <h2>Feature Comparison</h2>
            <div class="comparison-table-wrapper">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th>Free</th>
                            <th>Pro</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Prompt Storage</td>
                            <td>5 prompts</td>
                            <td>100 prompts</td>
                        </tr>
                        <tr>
                            <td>Daily Optimization Attempts</td>
                            <td>3</td>
                            <td>50</td>
                        </tr>
                        <tr>
                            <td>Quick Prompt Input</td>
                            <td><span class="check">✓</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Basic Prompt Library</td>
                            <td><span class="check">✓</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Multi-device Sync</td>
                            <td><span class="check">✓</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Prompt Categories</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Advanced Search</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Custom Tags</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Data Export</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Priority Support</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Early Access to New Features</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <section class="faq">
        <div class="container">
            <h2>Frequently Asked Questions</h2>
            <div class="faq-items">
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>How does the billing work?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>For monthly plans, you will be billed every month on the same date you initially subscribed. For annual plans, you will be billed once per year. All plans automatically renew unless cancelled.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>Can I upgrade from monthly to annual?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>Yes, you can upgrade from a monthly to an annual subscription at any time. When you upgrade, you'll be charged for the annual plan, and your monthly subscription will be cancelled.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>How do I cancel my subscription?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>You can cancel your subscription at any time through the AetherFlow extension settings or by accessing the customer portal. After cancellation, you'll still have access to Pro features until the end of your current billing period.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>What happens to my data if I downgrade?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>If you downgrade from Pro to Free, all your prompts will be preserved, but you'll only be able to actively use 5 prompts. The rest will be marked as read-only until you upgrade again.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>Do you offer refunds?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>Yes, we offer a 14-day refund window for new subscriptions. If you're not satisfied with our service during this period, you may request a full refund. Please refer to our <a href="refund-policy.html">Refund Policy</a> for more details.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>Which payment methods do you accept?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>We accept all major credit cards (Visa, MasterCard, American Express), as well as PayPal. All payments are securely processed through Paddle, our payment processor.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="cta">
        <div class="container">
            <h2>Ready to Enhance Your AI Experience?</h2>
            <p>Join thousands of users who are getting better results with AetherFlow Pro</p>
            <a href="#" class="btn btn-large" onclick="scrollToPlans()">Choose Your Plan</a>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h2>AetherFlow</h2>
                    <p>AI Prompt Management Chrome Extension</p>
                </div>
                <div class="footer-links">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="terms-of-service.html">Terms of Service</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="refund-policy.html">Refund Policy</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="pricing.html">Pricing</a></li>
                        <li><a href="https://chrome.google.com/webstore/detail/aetherflow/ldpadjcdbfndeghcklogoppmbnmphbki">Chrome Store</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h4>Contact</h4>
                    <p>Email: support@aetherflow.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 AetherFlow. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Firebase配置
        const firebaseConfig = {
            apiKey: "AIzaSyCulWQxvrzxDOLGOxzi2ngj9n0DwzvqJFw",
            authDomain: "aetherflow-b6459.firebaseapp.com",
            projectId: "aetherflow-b6459",
            storageBucket: "aetherflow-b6459.firebasestorage.app",
            messagingSenderId: "423266303314",
            appId: "1:423266303314:web:9cbf8adb847f043bd34e8b",
            measurementId: "G-ZD5E2WY22N"
        };

        // 初始化Firebase
        firebase.initializeApp(firebaseConfig);

        // 添加到window.onload以确保DOM完全加载
        window.onload = function() {
            // 其他现有的onload代码
            // 处理切换月度/年度价格的功能
            // ... existing code ...

            // 初始化认证功能
            initializeAuth();
        };

        // 检查URL参数中是否包含认证令牌
        function checkAuthTokenInUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            
            if (token) {
                // 使用令牌登录
                firebase.auth().signInWithCustomToken(token)
                    .then(() => {
                        console.log("使用令牌成功登录");
                        // 清除URL中的令牌参数
                        window.history.replaceState({}, document.title, window.location.pathname);
                    })
                    .catch(error => {
                        console.error("令牌登录失败:", error);
                    });
            }
        }

        // 初始化认证功能
        function initializeAuth() {
            // 获取DOM元素
            const authButton = document.getElementById('authButton');
            const authModal = document.getElementById('authModal');
            const closeButton = document.querySelector('.auth-close');
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const forgotPasswordForm = document.getElementById('forgotPasswordForm');
            const forgotPasswordLink = document.getElementById('forgotPasswordLink');
            const backToLoginLink = document.getElementById('backToLoginLink');
            const userDropdown = document.getElementById('userDropdown');
            const userDisplayName = document.getElementById('userDisplayName');
            const userEmail = document.getElementById('userEmail');
            const logoutButton = document.getElementById('logoutButton');
            
            // 登录相关元素
            const loginButton = document.getElementById('loginButton');
            const googleLoginButton = document.getElementById('googleLoginButton');
            const loginEmail = document.getElementById('loginEmail');
            const loginPassword = document.getElementById('loginPassword');
            const loginError = document.getElementById('loginError');
            
            // 注册相关元素
            const registerButton = document.getElementById('registerButton');
            const googleRegisterButton = document.getElementById('googleRegisterButton');
            const registerName = document.getElementById('registerName');
            const registerEmail = document.getElementById('registerEmail');
            const registerPassword = document.getElementById('registerPassword');
            const registerError = document.getElementById('registerError');
            
            // 重置密码相关元素
            const resetPasswordButton = document.getElementById('resetPasswordButton');
            const resetEmail = document.getElementById('resetEmail');
            const resetError = document.getElementById('resetError');
            const resetSuccess = document.getElementById('resetSuccess');
            
            // 切换登录/注册表单
            loginTab.addEventListener('click', () => {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginForm.classList.add('active');
                registerForm.classList.remove('active');
                forgotPasswordForm.classList.remove('active');
            });
            
            registerTab.addEventListener('click', () => {
                registerTab.classList.add('active');
                loginTab.classList.remove('active');
                registerForm.classList.add('active');
                loginForm.classList.remove('active');
                forgotPasswordForm.classList.remove('active');
            });
            
            // 忘记密码链接
            forgotPasswordLink.addEventListener('click', (e) => {
                e.preventDefault();
                loginForm.classList.remove('active');
                registerForm.classList.remove('active');
                forgotPasswordForm.classList.add('active');
            });
            
            // 返回登录链接
            backToLoginLink.addEventListener('click', (e) => {
                e.preventDefault();
                forgotPasswordForm.classList.remove('active');
                loginForm.classList.add('active');
            });
            
            // 打开/关闭模态框
            authButton.addEventListener('click', (e) => {
                e.preventDefault();
                if (firebase.auth().currentUser) {
                    // 如果已登录，显示用户下拉菜单
                    toggleUserDropdown();
                } else {
                    // 未登录，显示登录模态框
                    authModal.style.display = 'flex';
                }
            });
            
            closeButton.addEventListener('click', () => {
                authModal.style.display = 'none';
            });
            
            // 点击模态框外部关闭
            window.addEventListener('click', (e) => {
                if (e.target === authModal) {
                    authModal.style.display = 'none';
                }
                // 点击用户下拉菜单外部关闭
                if (userDropdown.style.display === 'block' && !e.target.closest('#authButton') && !e.target.closest('#userDropdown')) {
                    userDropdown.style.display = 'none';
                }
            });
            
            // 切换用户下拉菜单
            function toggleUserDropdown() {
                if (userDropdown.style.display === 'block') {
                    userDropdown.style.display = 'none';
                } else {
                    // 设置用户信息
                    const user = firebase.auth().currentUser;
                    if (user) {
                        userDisplayName.textContent = user.displayName || '用户';
                        userEmail.textContent = user.email || '';
                        
                        // 计算下拉菜单位置
                        const rect = authButton.getBoundingClientRect();
                        userDropdown.style.top = (rect.bottom + window.scrollY) + 'px';
                        userDropdown.style.right = (window.innerWidth - rect.right) + 'px';
                        userDropdown.style.display = 'block';
                    }
                }
            }
            
            // 登录功能
            loginButton.addEventListener('click', () => {
                const email = loginEmail.value.trim();
                const password = loginPassword.value;
                
                if (!email || !password) {
                    loginError.textContent = 'Please enter both email and password';
                    return;
                }
                
                loginButton.disabled = true;
                
                firebase.auth().signInWithEmailAndPassword(email, password)
                    .then(() => {
                        authModal.style.display = 'none';
                        loginError.textContent = '';
                        loginEmail.value = '';
                        loginPassword.value = '';
                    })
                    .catch(error => {
                        loginError.textContent = error.message;
                    })
                    .finally(() => {
                        loginButton.disabled = false;
                    });
            });
            
            // Google登录
            googleLoginButton.addEventListener('click', () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                
                googleLoginButton.disabled = true;
                
                firebase.auth().signInWithPopup(provider)
                    .then(() => {
                        authModal.style.display = 'none';
                    })
                    .catch(error => {
                        loginError.textContent = error.message;
                    })
                    .finally(() => {
                        googleLoginButton.disabled = false;
                    });
            });
            
            // 注册功能
            registerButton.addEventListener('click', () => {
                const name = registerName.value.trim();
                const email = registerEmail.value.trim();
                const password = registerPassword.value;
                
                if (!email || !password) {
                    registerError.textContent = 'Please enter email and password';
                    return;
                }
                
                registerButton.disabled = true;
                
                firebase.auth().createUserWithEmailAndPassword(email, password)
                    .then(result => {
                        if (name && result.user) {
                            return result.user.updateProfile({
                                displayName: name
                            }).then(() => result);
                        }
                        return result;
                    })
                    .then(() => {
                        authModal.style.display = 'none';
                        registerError.textContent = '';
                        registerName.value = '';
                        registerEmail.value = '';
                        registerPassword.value = '';
                    })
                    .catch(error => {
                        registerError.textContent = error.message;
                    })
                    .finally(() => {
                        registerButton.disabled = false;
                    });
            });
            
            // Google注册
            googleRegisterButton.addEventListener('click', () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                
                googleRegisterButton.disabled = true;
                
                firebase.auth().signInWithPopup(provider)
                    .then(() => {
                        authModal.style.display = 'none';
                    })
                    .catch(error => {
                        registerError.textContent = error.message;
                    })
                    .finally(() => {
                        googleRegisterButton.disabled = false;
                    });
            });
            
            // 重置密码
            resetPasswordButton.addEventListener('click', () => {
                const email = resetEmail.value.trim();
                
                if (!email) {
                    resetError.textContent = 'Please enter your email';
                    resetSuccess.textContent = '';
                    return;
                }
                
                resetPasswordButton.disabled = true;
                
                firebase.auth().sendPasswordResetEmail(email)
                    .then(() => {
                        resetSuccess.textContent = 'Password reset email sent. Check your inbox.';
                        resetError.textContent = '';
                        resetEmail.value = '';
                    })
                    .catch(error => {
                        resetError.textContent = error.message;
                        resetSuccess.textContent = '';
                    })
                    .finally(() => {
                        resetPasswordButton.disabled = false;
                    });
            });
            
            // 登出功能
            logoutButton.addEventListener('click', (e) => {
                e.preventDefault();
                
                firebase.auth().signOut()
                    .then(() => {
                        userDropdown.style.display = 'none';
                    })
                    .catch(error => {
                        console.error('Logout error:', error);
                    });
            });
            
            // 监听认证状态变化
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    // 已登录
                    authButton.textContent = user.displayName || user.email || 'Account';
                    authButton.classList.add('logged-in');
                    
                    // 更新支付按钮用户数据
                    updatePaymentButtonsWithUserData(user);
                } else {
                    // 未登录
                    authButton.textContent = 'Sign in';
                    authButton.classList.remove('logged-in');
                }
            });
            
            // 在支付按钮中添加用户数据
            function updatePaymentButtonsWithUserData(user) {
                const monthlyCheckout = document.querySelector('.monthly-checkout');
                const annualCheckout = document.querySelector('.annual-checkout');
                
                if (monthlyCheckout) {
                    monthlyCheckout.setAttribute('data-user-id', user.uid);
                    monthlyCheckout.setAttribute('data-user-email', user.email || '');
                }
                
                if (annualCheckout) {
                    annualCheckout.setAttribute('data-user-id', user.uid);
                    annualCheckout.setAttribute('data-user-email', user.email || '');
                }
            }
            
            // 检查URL中的认证令牌
            checkAuthTokenInUrl();
            
            // 修改支付按钮点击逻辑，确保用户已登录
            const checkoutButtons = document.querySelectorAll('.monthly-checkout, .annual-checkout');
            checkoutButtons.forEach(button => {
                // 保存原来的点击事件处理器
                const originalOnClick = button.onclick;
                
                // 替换为新的处理器
                button.onclick = function(e) {
                    e.preventDefault();
                    
                    // 检查用户是否已登录
                    if (!firebase.auth().currentUser) {
                        // 用户未登录，显示登录模态框
                        authModal.style.display = 'flex';
                        // 在模态框中添加一条消息
                        loginError.textContent = 'Please sign in to continue with your purchase';
                        return;
                    }
                    
                    // 用户已登录，继续原来的支付流程
                    if (originalOnClick) {
                        originalOnClick.call(this, e);
                    } else {
                        // 如果没有原来的处理器，则实现默认的支付逻辑
                        const plan = button.getAttribute('data-plan');
                        initPaddleCheckout(plan);
                    }
                };
            });
        }

        // Paddle支付处理
        function initPaddleCheckout(plan) {
            // 获取当前用户
            const user = firebase.auth().currentUser;
            if (!user) {
                console.error('User not authenticated');
                return;
            }
            
            // 获取沙盒环境指示符
            const urlParams = new URLSearchParams(window.location.search);
            const environment = urlParams.get('env') === 'sandbox' ? 'sandbox' : 'live';
            
            // 设置Paddle
            Paddle.Environment.set(environment);
            
            // 设置产品ID
            const productId = plan === 'monthly' ? 'pri_01hpxmkmvgkzfr5v5kwndwjxfa' : 'pri_01hpxmmvv13hnpsdz3fst43xq3';
            
            // 准备用户数据
            const userData = {
                userId: user.uid,
                email: user.email,
                plan: plan
            };
            
            // 初始化Paddle结账
            Paddle.Checkout.open({
                items: [
                    {
                        priceId: productId,
                        quantity: 1
                    }
                ],
                customer: {
                    email: user.email
                },
                passthrough: JSON.stringify(userData),
                successUrl: `${window.location.origin}/success.html?plan=${plan}&userId=${user.uid}`,
            });
        }

        // 切换月度/年度价格的函数
        function showMonthly() {
            document.querySelector('.monthly-plan').style.display = 'flex';
            document.querySelector('.annual-plan').style.display = 'none';
            document.querySelectorAll('.pricing-tab')[0].classList.add('active');
            document.querySelectorAll('.pricing-tab')[1].classList.remove('active');
        }

        function showAnnual() {
            document.querySelector('.monthly-plan').style.display = 'none';
            document.querySelector('.annual-plan').style.display = 'flex';
            document.querySelectorAll('.pricing-tab')[0].classList.remove('active');
            document.querySelectorAll('.pricing-tab')[1].classList.add('active');
        }

        // 处理FAQ折叠
        const faqItems = document.querySelectorAll('.faq-item');
        faqItems.forEach(item => {
            const question = item.querySelector('.faq-question');
            const answer = item.querySelector('.faq-answer');
            const toggle = item.querySelector('.faq-toggle');
            
            question.addEventListener('click', () => {
                const expanded = item.classList.contains('expanded');
                
                // 关闭所有其他FAQ项
                faqItems.forEach(otherItem => {
                    if (otherItem !== item) {
                        otherItem.classList.remove('expanded');
                        otherItem.querySelector('.faq-toggle').textContent = '+';
                    }
                });
                
                // 切换当前项
                if (expanded) {
                    item.classList.remove('expanded');
                    toggle.textContent = '+';
                } else {
                    item.classList.add('expanded');
                    toggle.textContent = '-';
                }
            });
        });
    </script>
</body>
</html> 