<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AetherFlow - Pricing</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Paddle Billing JS 集成 - 使用defer确保在DOM加载后执行 -->
    <script defer src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>AetherFlow</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="pricing.html" class="active">Pricing</a></li>
                    <li><a href="terms-of-service.html">Terms</a></li>
                    <li><a href="privacy-policy.html">Privacy</a></li>
                    <li><a href="refund-policy.html">Refunds</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="pricing-hero">
        <div class="container">
            <div class="pricing-hero-content">
                <h1>Simple, Transparent Pricing</h1>
                <p>Choose the plan that best fits your needs</p>
            </div>
        </div>
    </section>

    <section class="pricing-details">
        <div class="container">
            <div class="pricing-tabs">
                <button class="pricing-tab active" onclick="showMonthly()">Monthly</button>
                <button class="pricing-tab" onclick="showAnnual()">Annual (Save 33%)</button>
            </div>

            <div class="pricing-cards-container">
                <div class="pricing-cards">
                    <div class="pricing-card free">
                        <div class="card-header">
                            <h3>Free</h3>
                            <div class="price">$0</div>
                            <p>Forever</p>
                        </div>
                        <div class="card-features">
                            <ul>
                                <li>Store up to 5 prompts</li>
                                <li>3 optimization attempts daily</li>
                                <li>Basic features access</li>
                                <li>Single device usage</li>
                                <li>Community support</li>
                            </ul>
                        </div>
                        <div class="card-action">
                            <a href="https://chrome.google.com/webstore/detail/aetherflow/ldpadjcdbfndeghcklogoppmbnmphbki" class="btn btn-outline">Get Started</a>
                        </div>
                    </div>
                    <div class="pricing-card premium monthly-plan">
                        <div class="most-popular">Most Popular</div>
                        <div class="card-header">
                            <h3>Pro</h3>
                            <div class="price">$4.99</div>
                            <p>per month</p>
                        </div>
                        <div class="card-features">
                            <ul>
                                <li>Store up to 100 prompts</li>
                                <li>50 optimization attempts daily</li>
                                <li>All advanced features</li>
                                <li>Multi-device sync</li>
                                <li>Multi-format data export</li>
                                <li>Priority support</li>
                            </ul>
                        </div>
                        <div class="card-action">
                            <a href="#" class="btn btn-primary" onclick="return openPaddleCheckout('monthly')">Upgrade Now</a>
                        </div>
                    </div>
                    <div class="pricing-card premium annual-plan" style="display: none;">
                        <div class="best-value">Best Value</div>
                        <div class="card-header">
                            <h3>Pro Annual</h3>
                            <div class="price">$39.99</div>
                            <p>per year (Save 33%)</p>
                        </div>
                        <div class="card-features">
                            <ul>
                                <li>Store up to 100 prompts</li>
                                <li>50 optimization attempts daily</li>
                                <li>All advanced features</li>
                                <li>Multi-device sync</li>
                                <li>Multi-format data export</li>
                                <li>Priority support</li>
                                <li>Early access to new features</li>
                            </ul>
                        </div>
                        <div class="card-action">
                            <a href="#" class="btn btn-primary" onclick="return openPaddleCheckout('annual')">Upgrade Now</a>
                        </div>
                    </div>
                </div>
                <p class="subscription-note">All subscriptions automatically renew unless cancelled at least 24 hours before the end of the current period. You can manage your subscription in your account settings.</p>
            </div>
        </div>
    </section>

    <section class="features-comparison">
        <div class="container">
            <h2>Feature Comparison</h2>
            <div class="comparison-table-wrapper">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th>Free</th>
                            <th>Pro</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Prompt Storage</td>
                            <td>5 prompts</td>
                            <td>100 prompts</td>
                        </tr>
                        <tr>
                            <td>Daily Optimization Attempts</td>
                            <td>3</td>
                            <td>50</td>
                        </tr>
                        <tr>
                            <td>Quick Prompt Input</td>
                            <td><span class="check">✓</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Basic Prompt Library</td>
                            <td><span class="check">✓</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Multi-device Sync</td>
                            <td><span class="check">✓</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Prompt Categories</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Advanced Search</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Custom Tags</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Data Export</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Priority Support</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                        <tr>
                            <td>Early Access to New Features</td>
                            <td><span class="x">✕</span></td>
                            <td><span class="check">✓</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <section class="faq">
        <div class="container">
            <h2>Frequently Asked Questions</h2>
            <div class="faq-items">
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>How does the billing work?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>For monthly plans, you will be billed every month on the same date you initially subscribed. For annual plans, you will be billed once per year. All plans automatically renew unless cancelled.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>Can I upgrade from monthly to annual?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>Yes, you can upgrade from a monthly to an annual subscription at any time. When you upgrade, you'll be charged for the annual plan, and your monthly subscription will be cancelled.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>How do I cancel my subscription?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>You can cancel your subscription at any time through the AetherFlow extension settings or by accessing the customer portal. After cancellation, you'll still have access to Pro features until the end of your current billing period.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>What happens to my data if I downgrade?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>If you downgrade from Pro to Free, all your prompts will be preserved, but you'll only be able to actively use 5 prompts. The rest will be marked as read-only until you upgrade again.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>Do you offer refunds?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>Yes, we offer a 14-day refund window for new subscriptions. If you're not satisfied with our service during this period, you may request a full refund. Please refer to our <a href="refund-policy.html">Refund Policy</a> for more details.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>Which payment methods do you accept?</h3>
                        <span class="faq-toggle">+</span>
                    </div>
                    <div class="faq-answer">
                        <p>We accept all major credit cards (Visa, MasterCard, American Express), as well as PayPal. All payments are securely processed through Paddle, our payment processor.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="cta">
        <div class="container">
            <h2>Ready to Enhance Your AI Experience?</h2>
            <p>Join thousands of users who are getting better results with AetherFlow Pro</p>
            <a href="#" class="btn btn-large" onclick="scrollToPlans()">Choose Your Plan</a>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h2>AetherFlow</h2>
                    <p>AI Prompt Management Chrome Extension</p>
                </div>
                <div class="footer-links">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="terms-of-service.html">Terms of Service</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="refund-policy.html">Refund Policy</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="pricing.html">Pricing</a></li>
                        <li><a href="https://chrome.google.com/webstore/detail/aetherflow/ldpadjcdbfndeghcklogoppmbnmphbki">Chrome Store</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h4>Contact</h4>
                    <p>Email: support@aetherflow.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 AetherFlow. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化FAQ切换
            const faqQuestions = document.querySelectorAll('.faq-question');
            
            faqQuestions.forEach(item => {
                item.addEventListener('click', function() {
                    const faqItem = item.parentNode;
                    const answer = faqItem.querySelector('.faq-answer');
                    const toggle = item.querySelector('.faq-toggle');
                    
                    // 切换class
                    faqItem.classList.toggle('open');
                    
                    // 更新切换图标
                    if (faqItem.classList.contains('open')) {
                        toggle.textContent = '-';
                        answer.style.maxHeight = answer.scrollHeight + 'px';
                    } else {
                        toggle.textContent = '+';
                        answer.style.maxHeight = '0';
                    }
                });
            });
            
            // 检查Paddle是否已加载
            if (typeof Paddle === 'undefined') {
                console.warn('Paddle尚未加载，将尝试手动加载');
                loadPaddleScript();
            } else {
                console.log('Paddle已加载，初始化Billing');
                initializePaddleBilling();
            }
        });

        // 手动加载Paddle脚本
        function loadPaddleScript() {
            console.log('手动加载Paddle脚本');
            const script = document.createElement('script');
            script.src = 'https://cdn.paddle.com/paddle/v2/paddle.js';
            script.async = true;
            
            script.onload = function() {
                console.log('Paddle脚本加载成功');
                initializePaddleBilling();
            };
            
            script.onerror = function() {
                console.error('Paddle脚本加载失败');
                alert('支付系统加载失败，请刷新页面或稍后再试');
            };
            
            document.head.appendChild(script);
        }
        
        // 切换月度和年度价格
        function showMonthly() {
            document.querySelector('.monthly-plan').style.display = 'block';
            document.querySelector('.annual-plan').style.display = 'none';
            document.querySelectorAll('.pricing-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.pricing-tab')[0].classList.add('active');
        }
        
        function showAnnual() {
            document.querySelector('.monthly-plan').style.display = 'none';
            document.querySelector('.annual-plan').style.display = 'block';
            document.querySelectorAll('.pricing-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.pricing-tab')[1].classList.add('active');
        }
        
        // 滚动到价格计划部分
        function scrollToPlans() {
            document.querySelector('.pricing-details').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Paddle Billing 产品/价格ID
        const priceConfigs = {
            production: {
                monthly: 'pri_01jrfcwajex91zya4346h9ek32',
                annual: 'pri_01jrfcz25f4zdktr7rtt1pnzpw'
            },
            sandbox: {
                monthly: 'pri_01jrw0em3kydrg4rw523w6s574',
                annual: 'pri_01jrw0f7y1kfw9jc967eswbnrs'
            }
        };
        
        // 检测环境
        function getEnvironment() {
            const hostname = window.location.hostname;
            console.log('当前域名:', hostname);
            
            // 明确列出所有开发/测试环境域名
            const devDomains = ['localhost', '127.0.0.1', 'dev.aetherflow-app.com'];
            const isDevEnvironment = devDomains.includes(hostname);
            
            console.log('环境判断:', isDevEnvironment ? 'sandbox' : 'production');
            return isDevEnvironment ? 'sandbox' : 'production';
        }
        
        // 验证价格ID
        function validatePriceId(priceId) {
            // Paddle价格ID格式检查
            const validPriceIdPattern = /^pri_[a-z0-9]{20,36}$/;
            const isValidFormat = validPriceIdPattern.test(priceId);
            
            if (!isValidFormat) {
                console.error('价格ID格式不正确:', priceId);
                return false;
            }
            
            console.log('价格ID格式有效:', priceId);
            return true;
        }
        
        // 构建回调URL
        function buildCallbackUrls() {
            const baseUrl = window.location.origin;
            console.log('基础URL:', baseUrl);
            
            return {
                successUrl: `${baseUrl}/success.html?checkout={checkout}`,
                cancelUrl: `${baseUrl}/cancel.html`
            };
        }
        
        // 初始化Paddle Billing
        function initializePaddleBilling() {
            try {
                console.group('初始化Paddle Billing');
                console.log('开始初始化...');
                
                // 环境检测
                const env = getEnvironment();
                const isDevEnvironment = env === 'sandbox';
                
                // 设置环境和客户端ID
                // 注意: Paddle Billing 使用 client-id/token 而不是 vendor-id
                const clientId = isDevEnvironment ? 
                    'test_c624a7a4c9993fc8965d9c37db6' :  // 沙盒环境 token
                    'live_74080bad93a7d3b962f98a52c93';   // 生产环境 token
                
                console.log('使用环境:', env);
                console.log('使用客户端ID:', clientId);
                
                // 获取回调URL
                const callbacks = buildCallbackUrls();
                console.log('回调URL:', callbacks);
                
                // 初始化 Paddle Billing - 这里使用 Initialize 而不是 configure
                Paddle.Initialize({
                    token: clientId,
                    environment: isDevEnvironment ? 'sandbox' : 'production',
                    checkout: {
                        theme: 'light',
                        successUrl: callbacks.successUrl,
                        cancelUrl: callbacks.cancelUrl
                    }
                });
                
                console.log('Paddle Billing初始化成功');
                console.groupEnd();
                
            } catch (error) {
                console.error('初始化Paddle Billing出错:', error);
                console.groupEnd();
            }
        }
        
        // 打开Paddle Billing结账窗口
        function openPaddleCheckout(plan) {
            try {
                console.group('Paddle结账流程');
                console.log('计划类型:', plan);
                
                // 检查Paddle对象
                if (typeof Paddle === 'undefined') {
                    console.error('Paddle未定义!');
                    console.groupEnd();
                    alert('支付系统未加载，请刷新页面或稍后再试');
                    return false;
                }
                
                // 环境检测
                const env = getEnvironment();
                console.log('使用环境:', env);
                
                // 获取价格ID
                const config = priceConfigs[env === 'sandbox' ? 'sandbox' : 'production'];
                const priceId = plan === 'monthly' ? config.monthly : config.annual;
                console.log('价格ID:', priceId);
                
                // 验证价格ID
                if (!validatePriceId(priceId)) {
                    console.groupEnd();
                    alert('价格配置错误，请联系客服');
                    return false;
                }
                
                // 构建结账参数
                const checkoutParams = {
                    items: [
                        {
                            priceId: priceId,
                            quantity: 1
                        }
                    ],
                    customer: {
                        email: '' // 留空让用户在结账时填写
                    },
                    customData: {
                        source: 'website',
                        plan: plan
                    }
                };
                
                console.log('结账参数:', checkoutParams);
                
                // 打开结账界面 - 使用 Paddle.Checkout.open 方法
                Paddle.Checkout.open(checkoutParams);
                console.log('结账窗口已打开');
                console.groupEnd();
                
                return false; // 阻止链接默认行为
                
            } catch (error) {
                console.error('结账过程出错:', error);
                console.groupEnd();
                alert('支付系统出现问题，请稍后再试: ' + error.message);
                return false;
            }
        }
    </script>
</body>
</html> 